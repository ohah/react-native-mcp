# 가로 모드(landscape)에서 tap이 실패하는 원인과 좌표 보정 가능성

## 1. 관찰된 현상

| 모드 | 앱 measure (버튼 중앙) | idb tap 전달 좌표 | 결과                                 |
| ---- | ---------------------- | ----------------- | ------------------------------------ |
| 세로 | (410, 177)             | (410, 177)        | ✅ 성공                              |
| 가로 | (590, 155)             | (590, 155)        | ❌ 실패 (탭은 되지만 버튼 반응 없음) |

- 앱의 `measureInWindow`(또는 query_selector의 measure)와 **idb describe-all**은 같은 좌표계로 보임 (가로일 때도 버튼 프레임이 533.5, 133으로 일치).
- 그런데 **idb describe-point (590, 155)** 를 호출하면 빈 요소가 나옴 → “이 좌표에 뭔가 있다”고 idb가 인식하지 못함.
- 따라서 **idb ui tap**이 기대하는 좌표계가 **describe-all / 앱 measure와 다를 가능성**이 있음.

## 2. 원인 가설

- **가설 A**: idb `ui tap`은 **항상 세로(portrait) 기준 좌표**를 받고, 내부에서 물리 터치로 변환한다.  
  → 가로일 때는 앱이 주는 (x, y)가 “가로 창 기준”이므로, 그대로 넘기면 idb 쪽 “세로 기준” 해석과 어긋난다.
- **가설 B**: idb `describe-point`와 `ui tap`은 같은 좌표계를 쓰는데, **describe-all만 다른 좌표계**(또는 다른 레이어)를 쓴다.  
  → describe-point가 (590,155)에서 빈 요소를 반환하는 것과 tap이 먹지 않는 것이 같은 원인(좌표계 불일치)일 수 있다.
- **가설 C**: 터치 전달/히트테스트 이슈로, 같은 좌표여도 가로일 때만 RN/시뮬레이터가 버튼에 전달하지 못한다.  
  → 이 경우엔 좌표 보정만으로는 해결되지 않을 수 있음.

문서/검색만으로는 “idb tap이 정확히 어떤 좌표계(세로 고정인지, 현재 orientation인지)”가 명시돼 있지 않아, **실험으로 확인하는 수밖에 없음**.

## 3. 좌표 보정 아이디어 (가설 A 기준)

idb tap이 **항상 portrait 좌표**를 기대한다고 가정하면:

- 앱에서는 **현재 창 크기**를 알 수 있음: `getScreenInfo().window` → 가로일 때 `width > height` (예: 844×390).
- **Landscape Right** (시뮬레이터를 오른쪽으로 돌린 경우):
  - 가로 창 기준 (x_l, y_l) → 세로 기준 (x_p, y_p) 변환:  
    `x_p = window_height_land - y_l`, `y_p = x_l`
  - 즉 `(x_l, y_l)` → `(H_land - y_l, x_l)` (portrait에서의 좌표로 해석).
- **Landscape Left**라면 변환 공식이 다름:  
  `x_p = y_l`, `y_p = W_land - x_l` 등 (회전 방향에 따라 한 가지로 정해줘야 함).

우리가 가진 정보:

- `getScreenInfo()`로 **orientation** (`portrait` | `landscape`)과 **window** `{ width, height }` 확보 가능.
- “지금이 landscape right인지 left인지”는 RN `Dimensions`만으로는 구분이 안 될 수 있음 (width/height만 있음).  
  → 우선 **Landscape Right** 한 가지만 가정하고 보정을 적용한 뒤, tap이 성공하는지 시험해 보는 방식이 현실적.

정리하면:

- **보정 시도**:
  - orientation이 `landscape`일 때,  
    `(x_send, y_send) = (window.height - y, x)`
  - 이 (x_send, y_send)를 idb tap에 넘긴다.
- **검증**:
  - 가로 모드에서 위 보정으로 tap을 보내고,  
    버튼이 반응하는지(예: Count 증가), describe-point에 (x_send, y_send)를 넣었을 때 버튼이 잡히는지 확인.

## 4. 작업 전 요약

| 항목                | 내용                                                                                                                                                                                |
| ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **무엇이 문제인가** | 가로 모드에서 (앱 measure와 describe-all에선 맞는) 좌표로 idb tap을 해도 버튼이 반응하지 않음. describe-point도 같은 좌표에서 빈 요소를 반환함.                                     |
| **가능 원인**       | idb tap(및 describe-point)이 사용하는 좌표계가 “세로 고정”이거나, 앱/describe-all과 다를 가능성.                                                                                    |
| **보정 가능 여부**  | **가능성 있음.** idb가 portrait 좌표를 기대한다는 가정 하에, landscape일 때 `(x,y) → (H-y, x)` 형태로 변환해 보내는 방식으로 시도할 수 있음.                                        |
| **불확실 요소**     | (1) idb가 정말 portrait 좌표를 쓰는지, (2) landscape left/right 구분 필요 여부, (3) 기기/OS 버전별 차이. → **구현 후 가로 모드에서 한 번 돌려서 성공 여부로 검증**하는 수밖에 없음. |

## 5. 제안하는 다음 단계

1. **서버(tap 도구)에서**
   - orientation이 `landscape`일 때
   - `getScreenInfo().window`로 `width`, `height` 수집
   - `(x_send, y_send) = (height - y, x)` 로 보정
   - idb에는 보정된 좌표만 전달 (정수로 반올림 유지).
2. **가로 모드에서 YAML E2E 한 번 더 실행**
   - tap 후 Count가 올라가면 보정이 맞는 것.
   - 안 되면 landscape left 공식 시도하거나, idb 이슈/다른 원인을 추가로 조사.

이렇게 “실패 시 에러로 막기” 대신 “가로일 때만 좌표 보정 시도”로 바꾸면, 가로 모드에서도 동작할 가능성을 열어둘 수 있음.

---

## 6. 검증 결과 (실측)

가로 모드에서 idb tap에 여러 좌표를 넣어 본 결과:

| idb tap (ix, iy) | 변환 가설        | 결과         |
| ---------------- | ---------------- | ------------ |
| (590, 155)       | 앱 (x, y) 그대로 | 반응 없음    |
| (665, 590)       | (H−y, x)         | 반응 없음    |
| **(155, 590)**   | **(y, x)**       | **Count: 1** |

- 앱 measure 중앙 (590, 154.75) → idb에 **(155, 590)** 전달 시 버튼 반응 확인.
- **결론: iOS 가로 모드에서 idb tap이 기대하는 좌표는 앱 (x, y)의 (y, x) 스왑.**

보정 공식: `orientation === 'landscape'` 일 때 `(ix, iy) = (Math.round(y), Math.round(x))`.
